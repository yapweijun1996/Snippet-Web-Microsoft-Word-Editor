<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Snippet Web Microsoft Word Editor ‚Äî with Page & Image Controls</title>
<style>
  /* --- Reset / Base --- */
  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body {
    margin: 0;
    font-family: Calibri, "Segoe UI", Arial, sans-serif;
    background: #f5f5f5;
    color: #222;
  }
  body.modal-open { overflow: hidden; }
  .launch-bar {
    padding: 48px 24px;
    text-align: center;
    background: linear-gradient(135deg, #f5f5f5 30%, #e1e9ff 100%);
    min-height: 100vh;
    display: grid;
    place-items: center;
  }
  .launch-card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 12px 30px rgba(43,87,154,0.15);
    padding: 36px 48px;
    max-width: 420px;
  }
  .launch-card h1 { margin: 0 0 12px; font-size: 22px; color: #2b579a; }
  .launch-card p { margin: 0 0 24px; color: #4a4a4a; line-height: 1.6; }
  .launch-btn {
    display: inline-flex; align-items: center; gap: 8px;
    background: #2b579a; color: #fff; border: none;
    border-radius: 6px; padding: 12px 24px; cursor: pointer;
    font-size: 15px; font-weight: 600;
    box-shadow: 0 8px 20px rgba(43,87,154,0.25);
  }
  .launch-btn:hover { background: #244b86; }
  body.modal-open .launch-bar { display: none; }
  .pill {
    display: inline-block;
    padding: 0 10px;
    height: 24px;
    line-height: 24px;
    border-radius: 12px;
    background: #d2e3fc;
    color: #1a3d7c;
    font-size: 12px;
    font-weight: 600;
  }
  .editor-modal {
    position: fixed; inset: 0; background: rgba(0,0,0,0.45);
    display: none; align-items: stretch; justify-content: center;
    z-index: 3000; padding: 0;
    overflow: hidden;
  }
  .editor-modal.active { display: flex; }
  .editor-shell {
    background: #fff; border-radius: 0; width: 100%; max-width: none;
    display: flex; flex-direction: column; overflow: hidden;
    box-shadow: none;
    height: 100vh;
  }
  .editor-frame {
    background: #f5f5f5;
    flex: 1;
    display: flex; flex-direction: column;
    min-height: 0;
  }
  .header {
    background: #2b579a; color: #fff; padding: 8px 12px;
    display: flex; align-items: center; justify-content: space-between;
  }
  .header h1 { font-size: 16px; font-weight: 600; margin: 0; }
  .header-actions { display: flex; gap: 8px; align-items: center; }
  .toolbar {
    position: sticky; top: 0; z-index: 100; background: #f1f1f1;
    border-bottom: 1px solid #ddd; padding: 6px 8px; display: flex; flex-wrap: wrap; gap: 8px;
  }
  .group { display: inline-flex; align-items: center; gap: 6px; padding-right: 10px; border-right: 1px solid #ddd; }
  .group:last-child { border-right: 0; }
  .btn {
    height: 28px; min-width: 28px; padding: 0 8px; border: 1px solid #ddd; background: #fff;
    border-radius: 3px; cursor: pointer; font-size: 13px; display: inline-flex; align-items: center; justify-content: center;
  }
  .btn:hover { background: #e8f0fe; border-color: #1976d2; }
  .btn.active { background: #d2e3fc; border-color: #1976d2; }
  .btn:disabled {
    opacity: 0.45;
    cursor: not-allowed;
    background: #f5f5f5;
    border-color: #ddd;
  }
  select, input[type="number"], input[type="text"] {
    height: 28px; border: 1px solid #ddd; background: #fff; padding: 0 6px; border-radius: 3px; font-size: 13px;
  }
  .color-btn {
    width: 28px; height: 28px; border: 1px solid #ddd; background: #fff; position: relative; border-radius: 3px;
    display: inline-flex; align-items: center; justify-content: center; cursor: pointer; font-weight: 700;
  }
  .color-preview { position: absolute; left: 0; right: 0; bottom: 2px; height: 6px; border-top: 1px solid #eee; }
  .sr-file {
    position: fixed;
    top: -1000px;
    left: -1000px;
    width: 0.1px;
    height: 0.1px;
    opacity: 0;
    pointer-events: none;
  }

  /* --- Canvas / Page --- */
  .canvas {
    flex: 1;
    overflow: auto;
    background: #e8e8e8;
    padding: 20px 0 60px;
    min-height: 0;
  }
  .page-wrap {
    margin: 0 auto;
    box-shadow: 0 0 5px rgba(0,0,0,.15);
    background: #fff;
    position: relative;
    transform-origin: top center;
  }
  .page-content {
    outline: none;
    min-height: 10mm;
  }
  /* default (will be overridden by JS per selection) */
  .page-wrap { width: 210mm; }
  .page-content { padding: 20mm; font-size: 11pt; line-height: 1.5; }

  .page-break {
    height: 0; margin: 12px 0; border-top: 2px dashed #9aa0a6;
    position: relative; break-after: page; page-break-after: always;
  }
  .page-break::after {
    content: "Page Break";
    position: absolute; top: -12px; left: 50%; transform: translateX(-50%);
    font-size: 11px; color: #5f6368; background: #f5f5f5; padding: 0 6px;
  }
  .undo-flash {
    animation: undoFlash 0.8s ease-out;
  }
  @keyframes undoFlash {
    0% { background: rgba(255, 236, 179, 0.9); }
    100% { background: transparent; }
  }

  /* --- Feedback & overlays --- */
  .offline-banner {
    background: #fff4d7;
    color: #8a5300;
    text-align: center;
    font-size: 12px;
    font-weight: 600;
    padding: 6px 12px;
    border-bottom: 1px solid rgba(0,0,0,0.1);
  }
  .offline-banner[hidden] { display: none !important; }

  .toast-stack {
    position: fixed;
    top: 24px;
    right: 24px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: min(320px, 80vw);
    z-index: 5000;
    pointer-events: none;
  }
  .toast {
    pointer-events: auto;
    border-radius: 6px;
    border: 1px solid #d1d5db;
    padding: 10px 14px;
    font-size: 13px;
    line-height: 1.4;
    box-shadow: 0 12px 24px rgba(0,0,0,0.18);
    background: #fff;
    opacity: 0;
    transform: translateY(-8px) scale(0.98);
    transition: opacity 0.18s ease, transform 0.18s ease;
  }
  .toast--visible {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
  .toast--info { background: #e3f2fd; color: #0d47a1; border-color: #90caf9; }
  .toast--success { background: #e6f4ea; color: #0b5d1e; border-color: #9dd59f; }
  .toast--error { background: #fdecea; color: #8a1c1c; border-color: #f5b1ab; }
  .toast--warning { background: #fff4d7; color: #8a5300; border-color: #f9d19f; }

  .import-progress {
    position: fixed;
    top: 24px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 16px;
    border-radius: 8px;
    background: #fff;
    border: 1px solid #d1d5db;
    box-shadow: 0 12px 24px rgba(0,0,0,0.18);
    z-index: 5100;
  }
  .import-progress[hidden] { display: none !important; }
  .import-progress__spinner {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 2px solid #d2e3fc;
    border-top-color: #2b579a;
    animation: spin 0.9s linear infinite;
  }
  .import-progress__message {
    font-size: 13px;
    color: #1f1f1f;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* --- Status bar --- */
  .status {
    position: sticky;
    bottom: 0;
    background: #f1f1f1; border-top: 1px solid #ddd;
    display: flex; align-items: center; justify-content: space-between;
    padding: 6px 12px; font-size: 12px; z-index: 10;
  }

  /* --- Modals (simple) --- */
  .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.45); align-items: center; justify-content: center; z-index: 2000; }
  .modal.active { display: flex; }
  .modal-card { background: #fff; width: min(92vw, 520px); padding: 16px; border-radius: 6px; }
  .modal-head { display:flex; align-items:center; justify-content:space-between; margin-bottom: 10px; }
  .close-x { font-size: 22px; cursor: pointer; color: #777; }
  .form-row { margin-bottom: 10px; display: grid; grid-template-columns: 140px 1fr; gap: 10px; align-items: center; }
  .modal-actions { display: flex; gap: 8px; justify-content: flex-end; }

  /* --- Image selection adornments --- */
  .img-selected { outline: 2px solid #4285f4; }
  .img-handle {
    position: absolute; width: 10px; height: 10px; background: #4285f4; border-radius: 50%;
    right: -5px; bottom: -5px; cursor: se-resize; z-index: 50;
  }
  .img-toolbar, .table-toolbar {
    position: fixed; z-index: 3000; background: #fff; border: 1px solid #ddd; border-radius: 6px;
    box-shadow: 0 4px 18px rgba(0,0,0,.12); padding: 8px; display: none; min-width: 280px;
  }
  .img-toolbar .row, .table-toolbar .row { display: flex; align-items: center; gap: 6px; margin: 6px 0; flex-wrap: wrap; }
  .img-toolbar label, .table-toolbar label { font-size: 12px; color: #555; }
  td.cell-selected, th.cell-selected { outline: 2px solid #34a853; outline-offset: -2px; }

  /* --- Printing --- */
  @media print {
    body { background: #fff; }
    .header, .toolbar, .status, .img-toolbar, .table-toolbar, .toast-stack, .import-progress, .offline-banner { display: none !important; }
    .editor-modal, .editor-shell, .editor-frame {
      position: static;
      display: block;
      height: auto !important;
      overflow: visible !important;
    }
    .canvas {
      padding: 0;
      overflow: visible !important;
      height: auto !important;
    }
    .page-wrap { box-shadow: none; margin: 0; width: auto; transform: none !important; }
    .page-content { padding: 0; }
    .page-break { border: none; height: 0; }
    .page-break::after { display: none !important; }
  }
</style>

<!-- dynamic print style for @page will be injected here -->
<style id="printStyle">
  @page { size: A4 portrait; margin: 20mm; }
</style>
</head>
<body>
  <div class="launch-bar">
    <div class="launch-card">
      <h1>Snippet Web Microsoft Word Editor</h1>
      <p>Paste or import Word documents into a front-end-only workspace with A4 pagination, autosave, and export.</p>
      <button class="launch-btn" id="launchEditor">üöÄ Launch Editor</button>
    </div>
  </div>

<div class="editor-modal" id="editorModal" role="dialog" aria-modal="true" aria-labelledby="editorTitle">
    <div class="editor-shell">
      <div class="offline-banner" id="offlineBanner" role="status" aria-live="polite" hidden></div>
      <div class="editor-frame">
  <div class="header">
    <h1 id="editorTitle">üìù Web Word-like Editor</h1>
    <div class="header-actions">
      <button type="button" class="btn" id="btnNew">New</button>
      <button type="button" class="btn" id="btnOpen">Open</button>
      <button type="button" class="btn" id="btnSave">Save</button>
      <button type="button" class="btn" id="btnPrint">Print</button>
      <button type="button" class="btn" id="btnCloseEditor" title="Close editor">√ó</button>
    </div>
  </div>

  <!-- Toolbar -->
  <div class="toolbar" role="toolbar" aria-label="Editor toolbar">
    <!-- Undo/Redo -->
    <div class="group">
      <button type="button" class="btn" id="btnUndo" title="Undo">‚Ü∂</button>
      <button type="button" class="btn" id="btnRedo" title="Redo">‚Ü∑</button>
    </div>

    <!-- Clipboard -->
    <div class="group">
      <button class="btn" data-cmd="cut" title="Cut">‚úÇ</button>
      <button class="btn" data-cmd="copy" title="Copy">üìã</button>
      <button class="btn" id="btnPaste" title="Paste">üìå</button>
    </div>

    <!-- Font -->
    <div class="group">
      <select id="fontName" title="Font family">
        <option value="">Font</option>
        <option>Arial</option>
        <option selected>Calibri</option>
        <option>Cambria</option>
        <option>Courier New</option>
        <option>Georgia</option>
        <option>Times New Roman</option>
        <option>Verdana</option>
      </select>
      <select id="fontSize" title="Font size (pt)">
        <option value="">Size</option>
        <option>8</option><option>9</option><option>10</option><option>11</option><option>12</option>
        <option>14</option><option>16</option><option>18</option><option>20</option><option>22</option>
        <option>24</option><option>28</option><option>36</option><option>48</option><option>72</option>
      </select>
      <button class="btn" data-cmd="bold"><b>B</b></button>
      <button class="btn" data-cmd="italic"><i>I</i></button>
      <button class="btn" data-cmd="underline"><u>U</u></button>
      <button class="btn" data-cmd="strikeThrough"><s>S</s></button>
      <button class="btn" data-cmd="subscript">x‚ÇÇ</button>
      <button class="btn" data-cmd="superscript">x¬≤</button>
    </div>

    <!-- Colors -->
    <div class="group">
      <button class="color-btn" id="btnColorText" title="Text color">A<div class="color-preview" id="cpText" style="background:black;"></div></button>
      <input type="color" id="colorText" style="display:none" value="#000000"/>
      <button class="color-btn" id="btnColorHilite" title="Highlight">A<div class="color-preview" id="cpHilite" style="background:yellow;"></div></button>
      <input type="color" id="colorHilite" style="display:none" value="#ffff00"/>
    </div>

    <!-- Align & Lists -->
    <div class="group">
      <button class="btn" data-cmd="justifyLeft" title="Align left">‚¨Ö</button>
      <button class="btn" data-cmd="justifyCenter" title="Align center">‚¨å</button>
      <button class="btn" data-cmd="justifyRight" title="Align right">‚û°</button>
      <button class="btn" data-cmd="justifyFull" title="Justify">‚ò∞</button>
      <button class="btn" data-cmd="insertOrderedList" title="Numbered list">1.</button>
      <button class="btn" data-cmd="insertUnorderedList" title="Bulleted list">‚Ä¢</button>
      <button class="btn" data-cmd="outdent" title="Outdent">‚á§</button>
      <button class="btn" data-cmd="indent" title="Indent">‚á•</button>
      <select id="listStyle" title="List style">
        <option value="">List style</option>
        <option value="ul:disc">‚Ä¢ Disc</option>
        <option value="ul:circle">‚óã Circle</option>
        <option value="ul:square">‚ñ† Square</option>
        <option value="ol:decimal">1. Decimal</option>
        <option value="ol:lower-alpha">a. Lower alpha</option>
        <option value="ol:upper-alpha">A. Upper alpha</option>
        <option value="ol:lower-roman">i. Lower roman</option>
        <option value="ol:upper-roman">I. Upper roman</option>
      </select>
    </div>

    <!-- Insert -->
    <div class="group">
      <button class="btn" id="btnLink" title="Insert link">üîó</button>
      <button class="btn" id="btnImage" title="Insert image">üñº</button>
      <button class="btn" id="btnTable" title="Insert table">‚äû</button>
      <button type="button" class="btn" data-cmd="insertHorizontalRule" title="Horizontal line">‚Äî</button>
      <button class="btn" id="btnPageBreak" title="Insert page break">‚§ì</button>
    </div>

    <!-- Page Setup -->
    <div class="group" title="Page setup">
      <span style="font-size:12px;color:#555;">Paper:</span>
      <span class="pill" aria-label="Paper size locked to A4">A4</span>
      <select id="orientation">
        <option>portrait</option>
        <option>landscape</option>
      </select>
      <label style="font-size:12px;color:#555;">Margins (mm):</label>
      <input type="number" id="margin" value="20" min="5" max="50" style="width:64px" />
      <label style="font-size:12px;color:#555;">Zoom:</label>
      <select id="zoom">
        <option>80%</option><option>90%</option><option selected>100%</option><option>110%</option><option>125%</option><option>150%</option>
      </select>
    </div>

    <!-- Tools -->
    <div class="group">
      <button type="button" class="btn" id="btnFind" title="Find & Replace">üîç</button>
      <button type="button" class="btn" id="btnClearFormat" title="Clear formatting">‚úñ</button>
    </div>
  </div>

  <!-- Canvas / Page -->
  <div class="canvas">
    <div class="page-wrap" id="pageWrap">
      <div class="page-content" id="editor" contenteditable="true" spellcheck="true">
        <h1 style="text-align:center;">Welcome!</h1>
        <p>Paste from Word and keep your formatting (bold, italic, underline, alignment, lists, tables, etc.).</p>
        <p>Try inserting an image ‚Äî click it to control size, alignment, wrap, border, radius, shadow, or drag the corner handle to resize.</p>
        <p>You can also insert a <em>Page Break</em>, and dial in A4 orientation + margins with real mm units. Print uses real <code>@page</code> rules.</p>
      </div>
    </div>
  </div>
      </div>

  <!-- Status -->
  <div class="status">
    <div>Words: <span id="statWords">0</span> &nbsp; Characters: <span id="statChars">0</span></div>
    <div id="saveStatus">Ready</div>
  </div>

  <!-- Hidden inputs -->
  <input type="file" id="fileOpen" accept=".html,.htm,.txt,.docx" class="sr-file" tabindex="-1" />
  <input type="file" id="fileImg" accept="image/*" class="sr-file" tabindex="-1" />
    </div>
  <!-- Link modal -->
  <div class="modal" id="modalLink">
    <div class="modal-card">
      <div class="modal-head">
        <h3>Insert Link</h3>
        <span class="close-x" data-close="modalLink">√ó</span>
      </div>
      <div class="form-row">
        <label>URL</label>
        <input type="text" id="linkURL" placeholder="https://example.com"/>
      </div>
      <div class="form-row">
        <label>Text (optional)</label>
        <input type="text" id="linkText" placeholder="Text to display"/>
      </div>
      <div class="modal-actions">
        <button class="btn" data-close="modalLink">Cancel</button>
        <button class="btn" id="doInsertLink" style="background:#1976d2;color:#fff;border:0;">Insert</button>
      </div>
    </div>
  </div>

  <!-- Table modal -->
  <div class="modal" id="modalTable">
    <div class="modal-card">
      <div class="modal-head">
        <h3>Insert Table</h3>
        <span class="close-x" data-close="modalTable">√ó</span>
      </div>
      <div class="form-row">
        <label>Rows</label><input type="number" id="tblRows" min="1" max="100" value="3"/>
      </div>
      <div class="form-row">
        <label>Columns</label><input type="number" id="tblCols" min="1" max="20" value="3"/>
      </div>
      <div class="modal-actions">
        <button class="btn" data-close="modalTable">Cancel</button>
        <button class="btn" id="doInsertTable" style="background:#1976d2;color:#fff;border:0;">Insert</button>
      </div>
    </div>
  </div>

  <!-- Find/Replace modal -->
  <div class="modal" id="modalFind">
    <div class="modal-card">
      <div class="modal-head">
        <h3>Find & Replace</h3>
        <span class="close-x" data-close="modalFind">√ó</span>
      </div>
      <div class="form-row">
        <label>Find</label><input type="text" id="findTxt"/>
      </div>
      <div class="form-row">
        <label>Replace</label><input type="text" id="replTxt"/>
      </div>
      <div class="modal-actions">
        <button class="btn" id="doFind">Find next</button>
        <button class="btn" id="doReplace">Replace</button>
        <button class="btn" id="doReplaceAll" style="background:#1976d2;color:#fff;border:0;">Replace all</button>
      </div>
    </div>
  </div>

  <!-- Floating Image Toolbar -->
  <div class="img-toolbar" id="imgToolbar" role="dialog" aria-label="Image tools">
    <div class="row">
      <label>Width:</label>
      <input type="range" id="imgWidth" min="20" max="1600" value="300" style="width:140px"/>
      <label><input type="checkbox" id="imgLock" checked/> Lock ratio</label>
      <span id="imgSizeLabel" style="font-size:12px;color:#555;">300√ó‚Äî</span>
    </div>
    <div class="row">
      <label>Align:</label>
      <button class="btn" id="imgAlignLeft">Left</button>
      <button class="btn" id="imgAlignCenter">Center</button>
      <button class="btn" id="imgAlignRight">Right</button>
      <button class="btn" id="imgFloatLeft" title="Wrap left">Wrap ‚¨Ö</button>
      <button class="btn" id="imgFloatRight" title="Wrap right">Wrap ‚û°</button>
      <button class="btn" id="imgFloatNone" title="No wrap">No wrap</button>
    </div>
    <div class="row">
      <label>Border:</label>
      <button class="btn" id="imgBorderToggle">On/Off</button>
      <label>Radius</label><input type="range" id="imgRadius" min="0" max="40" value="0" style="width:100px"/>
      <label>Shadow</label><button class="btn" id="imgShadowToggle">On/Off</button>
    </div>
    <div class="row">
      <button class="btn" id="imgReplace">Replace URL</button>
      <button class="btn" id="imgUpload">Upload‚Ä¶</button>
      <button class="btn" id="imgRemove" style="color:#b00020;border-color:#f3cbd0;">Remove</button>
    </div>
  </div>

  <div class="table-toolbar" id="tableToolbar" role="dialog" aria-label="Table tools">
    <div class="row">
      <button class="btn" id="tblAddRowAbove" title="Add row above">Row ‚Üë</button>
      <button class="btn" id="tblAddRowBelow" title="Add row below">Row ‚Üì</button>
      <button class="btn" id="tblAddColLeft" title="Add column left">Col ‚Üê</button>
      <button class="btn" id="tblAddColRight" title="Add column right">Col ‚Üí</button>
      <button class="btn" id="tblDeleteRow" title="Delete row" style="color:#b00020;">Del Row</button>
      <button class="btn" id="tblDeleteCol" title="Delete column" style="color:#b00020;">Del Col</button>
    </div>
    <div class="row">
      <button class="btn" id="tblToggleHeader" title="Toggle header row">Header</button>
      <label>Align:</label>
      <button class="btn" id="tblAlignLeft">Left</button>
      <button class="btn" id="tblAlignCenter">Center</button>
      <button class="btn" id="tblAlignRight">Right</button>
    </div>
    <div class="row">
      <label>Borders:</label>
      <button class="btn" data-border="all">All</button>
      <button class="btn" data-border="none">None</button>
      <button class="btn" data-border="top">Top</button>
      <button class="btn" data-border="right">Right</button>
      <button class="btn" data-border="bottom">Bottom</button>
      <button class="btn" data-border="left">Left</button>
    </div>
  </div>
</div>
<div class="toast-stack" id="toastStack" aria-live="polite" aria-atomic="true"></div>
<div class="import-progress" id="importProgress" role="status" aria-live="polite" hidden>
  <span class="import-progress__spinner" aria-hidden="true"></span>
  <span class="import-progress__message" id="importProgressMessage">Preparing...</span>
</div>
<script src="libs/mammoth.browser.min.js"></script>
<script src="word_editor.js"></script>
</body>
</html>
